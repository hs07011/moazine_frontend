<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ï£ºÎ≥Ä Í¥ÄÍ¥ëÏßÄ Î∞è ÎßõÏßë ÏÜåÍ∞ú HJM ÏÑúÎπÑÏä§</title>
  <script src="https://w.soundcloud.com/player/api.js" async></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Î™®Îçò Ïª¨Îü¨ ÌåîÎ†àÌä∏ */
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-color: #4facfe;
      --success-color: #43e97b;
      --warning-color: #fa709a;
      
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      
      --bg-primary: #ffffff;
      --bg-secondary: #f7fafc;
      --bg-tertiary: #edf2f7;
      
      --border-color: #e2e8f0;
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      --border-radius-sm: 8px;
      --border-radius-md: 12px;
      --border-radius-lg: 16px;
      --border-radius-xl: 24px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .header {
      background: var(--primary-gradient);
      color: #fff;
      padding: clamp(20px, 4vw, 40px) clamp(24px, 6vw, 80px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 24px;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }

    .header > * {
      position: relative;
      z-index: 1;
    }

    .header-title {
      font-size: clamp(2.8rem, 6vw, 4.8rem);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin: 0;
      white-space: nowrap;
      word-break: keep-all;
      min-width: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-search {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: var(--border-radius-lg);
      padding: clamp(8px, 2vw, 12px) clamp(16px, 3vw, 24px);
      flex-grow: 1;
      min-width: 0;
      max-width: 700px;
      margin: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header-search:focus-within {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
      background: rgba(255, 255, 255, 1);
    }

    #destination {
      border: none;
      outline: none;
      font-size: clamp(1.6rem, 2.8vw, 2rem);
      font-weight: 500;
      padding: clamp(12px, 2vw, 16px) clamp(16px, 3vw, 24px);
      width: 100%;
      background: transparent;
      flex-grow: 1;
      transition: all 0.3s ease;
      color: var(--text-primary);
    }

    #destination::placeholder {
      color: var(--text-muted);
      font-weight: 400;
    }

    #searchBtn {
      background: var(--secondary-gradient);
      color: #fff;
      border: none;
      font-size: clamp(1.8rem, 3.2vw, 2.4rem);
      font-weight: 600;
      padding: 18px 36px;
      border-radius: var(--border-radius-md);
      margin-left: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    #searchBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    #searchBtn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    #searchBtn:hover::before {
      left: 100%;
    }

    #searchBtn:active {
      transform: translateY(0);
    }

    .main {
      display: flex;
      gap: 0;
      padding: 16px 0 0 0;
      max-width: 100vw;
    }

    .map-container, .side-tables {
      flex: 1 1 0;
      min-width: 0;
      width: 50%;
      max-width: 50%;
      box-sizing: border-box;
    }

    .map-container {
      background: var(--bg-primary);
      border-radius: 16px 0 0 16px;
      box-shadow: var(--shadow-lg);
      padding: 0;
      margin-right: 0;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border-color);
      padding-right: 0;
    }

    .map-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--accent-gradient);
      z-index: 1;
    }

    #map {
      width: 100%;
      height: 100%;
      border-radius: var(--border-radius-xl);
    }

    .side-tables {
      display: flex;
      flex-direction: column;
      gap: 32px;
      border-radius: 0 16px 16px 0;
      margin-left: 0;
      padding-left: 0;
    }

    .table-section {
      background: var(--bg-primary);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-lg);
      padding: 0 0 16px 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-color);
      position: relative;
    }

    .table-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      z-index: 1;
    }

    .attraction-table::before {
      background: var(--success-gradient);
    }

    .restaurant-table::before {
      background: var(--warning-gradient);
    }

    .table-title {
      font-size: 2.4rem;
      font-weight: 700;
      padding: 20px 24px 16px 24px;
      text-align: left;
      letter-spacing: -0.01em;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .table-title img {
      width: 32px;
      height: 32px;
      border-radius: var(--border-radius-sm);
      box-shadow: var(--shadow-sm);
    }

    .table-container {
      flex: 1;
      overflow-y: auto;
      max-height: calc(100% - 60px);
      height: 100%;
      min-height: 0;
      display: flex;
      flex-direction: column;
      justify-content: stretch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.8rem;
      font-weight: 500;
      height: 100%;
      table-layout: fixed;
    }

    th, td {
      padding: 16px 20px;
      text-align: left;
      height: 1%;
      vertical-align: middle;
      word-break: break-all;
      white-space: nowrap;
      border-bottom: 1px solid var(--border-color);
      transition: all 0.2s ease;
    }

    th {
      background: var(--bg-tertiary);
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 1.6rem;
    }

    tr {
      height: calc(10vh - 8px);
      min-height: 0;
      max-height: none;
      transition: all 0.2s ease;
    }

    tr:last-child {
      border-bottom: none;
    }

    td.score {
      text-align: right;
      font-weight: 600;
      font-size: 1.6rem;
      color: var(--primary-color);
    }

    tr.clickable {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    tr.clickable:hover {
      background: rgba(102, 126, 234, 0.08) !important;
      transform: translateX(4px);
      box-shadow: var(--shadow-sm);
    }

    .restaurant-table tr.clickable:hover {
      background: rgba(245, 87, 108, 0.08) !important;
    }

    /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùºÎßÅ */
    .table-container::-webkit-scrollbar {
      width: 8px;
    }

    .table-container::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: var(--border-radius-sm);
    }

    .table-container::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: var(--border-radius-sm);
      transition: background 0.2s ease;
    }

    .table-container::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    @media (min-width: 1001px) {
      .main {
        align-items: stretch;
        min-height: 80vh;
      }
      .map-container, .side-tables {
        height: 80vh;
      }
      #map {
        min-height: 420px;
      }
      .table-section {
        flex: 1 1 0;
      }
    }

    @media (max-width: 1000px) {
      .main { flex-direction: column; gap: 18px; padding: 18px 4vw 32px 4vw; }
      .map-container, .side-tables { max-width: 100vw; width: 100%; height: auto; flex: none; }
      #map { height: 40vh; min-height: 300px; }
      .table-container { max-height: 300px; }
      .side-tables { max-width: 100vw; }
    }

    @media (max-width: 768px) {
      .header { flex-direction: column; align-items: stretch; }
      .header-title { text-align: center; white-space: normal; }
      .header-search { width: auto; max-width: none; }
    }

    @media (max-width: 600px) {
      .main { padding: 4px 1vw 16px 1vw; }
      .map-container, .side-tables { min-width: 0; }
      #map { height: 200px; min-height: 200px; }
      .table-title { font-size: 1.1rem; padding: 8px 0 8px 8px; }
      table { font-size: 1.1rem; }
      th, td { padding: 10px 6px; }
      .side-tables { gap: 10px; }
      .table-section img { width: 1.2rem !important; height: 1.2rem !important; }
      .table-container { max-height: 250px; }
      .table-container::-webkit-scrollbar { width: 4px; }
      .details-popup {
        position: fixed !important;
        width: 96vw !important;
        max-width: 98vw !important;
        left: 50% !important;
        top: 30px !important;
        transform: translateX(-50%) !important;
        border-width: 2px !important;
        font-size: 1.2rem !important;
        padding: 0 !important;
        z-index: 3000 !important;
      }
      .content-bar img, .content-bar .default-logo { width: 60px; height: 60px; border-radius: 12px; font-size: 1.8rem; }
      .content-bar span { font-size: 1.05rem; }
      .header-btn { font-size: 1.4rem; padding: 12px 20px; }
    }

    .summary-btn {
      font-size: clamp(1.4rem, 2.2vw, 1.8rem);
      font-weight: 600;
      padding: clamp(8px, 2vw, 12px) clamp(18px, 3vw, 28px);
      border-radius: var(--border-radius-md);
      border: 2px solid var(--primary-color);
      background: var(--bg-primary);
      color: var(--primary-color);
      cursor: pointer;
      margin-right: 8px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      position: relative;
      overflow: hidden;
    }

    .summary-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--primary-gradient);
      transition: left 0.3s ease;
      z-index: -1;
    }

    .summary-btn:hover {
      color: #fff;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: transparent;
    }

    .summary-btn:hover::before {
      left: 0;
    }

    .summary-popup {
      display: none;
      position: absolute;
      top: 5%;
      left: 50%;
      width: 48%;
      min-width: 240px;
      max-width: 98%;
      min-height: 200px;
      max-height: 80vh;
      background: #fff;
      border: 3px solid #222;
      border-radius: 12px;
      box-shadow: 0 4px 24px #0003;
      padding: 36px 40px 32px 40px;
      font-size: 2.2rem;
      color: #222;
      z-index: 1000;
      line-height: 1.7;
      overflow-y: auto;
      transform: translateX(-2%);
    }

    .summary-popup .close-btn {
      position: absolute;
      top: 10px;
      right: 18px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #888;
      font-weight: bold;
    }

    .destination-intro-popup {
      display: none;
      position: absolute;
      top: 5%;
      left: 50%;
      width: 48%;
      min-width: 240px;
      max-width: 98%;
      min-height: 200px;
      background: #fff;
      border: 3px solid #217093;
      border-radius: 12px;
      box-shadow: 0 4px 24px #0003;
      padding: 36px 40px 32px 40px;
      font-size: 2.2rem;
      color: #222;
      z-index: 2000;
      line-height: 1.7;
      overflow-y: auto;
      transform: translateX(-2%);
    }

    .destination-intro-popup .close-btn {
      position: absolute;
      top: 10px;
      right: 18px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #888;
      font-weight: bold;
    }

    .destination-intro-popup .title {
      font-size: 2.8rem;
      font-weight: bold;
      color: #217093;
      margin-bottom: 20px;
      text-align: center;
    }

    .destination-intro-popup .guide-text {
      font-size: 2.2rem;
      line-height: 1.8;
      text-align: justify;
    }

    @media (max-width: 1000px) {
      .summary-popup {
        width: 96vw;
        left: 2vw;
        min-width: 0;
        max-width: 98vw;
        padding: 18px 8px 14px 8px;
        font-size: 1.5rem;
        transform: none;
      }
      .destination-intro-popup {
        width: 96vw;
        left: 2vw;
        min-width: 0;
        max-width: 98vw;
        padding: 18px 8px 14px 8px;
        font-size: 1.5rem;
        transform: none;
      }
      .destination-intro-popup .title {
        font-size: 1.8rem;
        margin-bottom: 15px;
      }
      .destination-intro-popup .guide-text {
        font-size: 1.5rem;
        line-height: 1.6;
      }
    }

    .details-popup {
      display: none;
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-100%);
      width: 117vw;
      max-width: 780px;
      max-height: 80vh;
      background: #fff;
      border: 3px solid #333;
      border-radius: 12px;
      box-shadow: 0 8px 30px #0000004d;
      font-size: 1.6rem;
      color: #333;
      z-index: 2000;
      line-height: 1.7;
      overflow-y: auto;
    }
    .details-popup-content {
      padding: 24px;
      display: flex;
      flex-direction: column;
    }
    .details-popup .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      cursor: pointer;
      font-size: 2rem;
      color: #aaa;
      font-weight: bold;
    }
    .details-popup-header {
      font-size: 2.4rem;
      font-weight: bold;
      color: #217093;
      margin-bottom: 16px;
      border-bottom: 2px solid #eee;
      padding-bottom: 12px;
    }
    .details-popup-content .detail-item {
      margin-bottom: 12px;
      display: grid;
      grid-template-columns: max-content 1fr;
      align-items: center;
      gap: 15px;
    }
    .details-popup-content .detail-item .label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      color: #555;
    }
    .details-popup-content .detail-item .value {
      overflow-wrap: break-word;
    }
    .details-popup-content .detail-item .value a {
      color: #1a0dab;
      text-decoration: none;
      font-weight: 500;
    }
    .details-popup-content .detail-item .value a:hover {
      text-decoration: underline;
    }
    .details-popup .reviews-section {
      margin-top: 20px;
      border-top: 2px solid #eee;
      padding-top: 15px;
    }
    .details-popup .reviews-section .review {
      margin-bottom: 15px;
      font-size: 1.4rem;
      line-height: 1.6;
    }
    .details-popup .reviews-section .review-author {
      font-weight: bold;
      color: #217093;
    }
    @media (max-width: 600px) {
      .details-popup {
        font-size: 1.4rem;
      }
      .details-popup-header {
        font-size: 2rem;
      }
    }
    /* ÏΩîÏä§ Ï∂îÏ≤ú ÌåùÏóÖ ÎÇ¥ Í∞Å ÏΩîÏä§ Íµ¨Î∂Ñ Ïä§ÌÉÄÏùº */
    .course-block {
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      background: #f9f9fc;
      margin-bottom: 20px;
      padding: 16px 14px 12px 14px;
      box-shadow: 0 2px 8px #0001;
    }
    .course-block.course-1 {
      border-color: #8ecae6;
      background: #e0f7fa;
    }
    .course-block.course-2 {
      border-color: #ffd166;
      background: #fffbe6;
    }
    .course-block.course-3 {
      border-color: #b7e4c7;
      background: #f1faee;
    }
    .course-block:last-child { margin-bottom: 0; }
    .course-title {
      font-size: 1.3rem; 
      font-weight: 900; 
      margin-bottom: 10px; 
      color: #217093; 
      display: flex; 
      align-items: center; 
      gap: 15px; 
      letter-spacing: 0.5px; 
      flex-wrap: wrap;
    }
    .course-rating { font-weight: bold; color: #e6b800; margin-top: 6px; }
    .course-block blockquote { border-left: 4px solid #217093; background: #eef6fa; margin: 8px 0; padding: 6px 12px; color: #217093; font-size: 1.1em; line-height: 1.05; }
    .course-block p { margin: 4px 0; line-height: 1.05; }
    .course-intro {
      font-size: 2.1rem;
      font-weight: 900;
      color: #222;
      margin-bottom: 24px;
      line-height: 0.975;
      letter-spacing: 0.5px;
    }
    .course-btn {
      font-size: clamp(1.8rem, 3.2vw, 2.4rem);
      font-weight: 600;
      padding: 18px 36px;
      border-radius: var(--border-radius-md);
      margin-left: 12px;
      background: var(--success-gradient);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      box-sizing: border-box;
      display: inline-block;
      vertical-align: middle;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    .course-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    .course-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    .course-btn:hover::before {
      left: 100%;
    }
    .course-btn:active {
      transform: translateY(0);
    }
    
    /* ÏΩîÏä§ ÏßÄÎèÑ ÌåùÏóÖ Ïä§ÌÉÄÏùº */
    .course-map-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .course-map-content {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      width: 95%;
      max-width: 1200px;
      max-height: 95vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    }
    
    .course-map-popup .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      cursor: pointer;
      font-size: 2rem;
      color: #aaa;
      font-weight: bold;
      z-index: 10;
    }
    
    .course-map-popup .close-btn:hover {
      color: #333;
    }
    
    /* Í∏∏ÏïàÎÇ¥ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
    .route-btn {
      background: #ff6b35 !important;
      color: #fff !important;
      border: 2px solid #ff6b35 !important;
      padding: 10px 22px !important;
      border-radius: 8px !important;
      cursor: pointer;
      font-size: 1.15rem !important;
      font-weight: bold;
      box-shadow: 0 2px 8px #ff6b3533;
      white-space: nowrap;
      flex-shrink: 0;
      transition: background 0.2s, border 0.2s, color 0.2s;
      outline: none;
      margin-left: 10px;
      display: inline-block;
      vertical-align: middle;
    }
    .route-btn:hover, .route-btn:focus {
      background: #e55a2b !important;
      border-color: #e55a2b !important;
      color: #fff !important;
    }
    
    @media (max-width: 768px) {
      .course-map-content {
        width: 98%;
        padding: 20px;
        margin: 5px;
      }
      
      .course-map-popup #courseMap {
        height: 600px;
      }
      
      .course-title {
        font-size: 2rem;
        gap: 10px;
      }
      
      .route-btn {
        font-size: 1rem;
        padding: 5px 10px;
      }
    }
    .site-scroll-row {
      display: flex;
      gap: 32px;
      padding: 20px;
      background: #f9f9f9;
      border-bottom: 1px solid #ddd;
      overflow-x: auto;
      overflow-y: visible;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      cursor: grab;
    }
    .site-block {
      min-width: 320px;
      max-width: 420px;
      flex: 0 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      padding: 10px 8px 18px 8px;
      text-align: center;
      border: 1px solid #eee;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .site-block:active {
      box-shadow: 0 4px 16px #0002;
    }
    .site-block h3 {
      margin: 0 0 10px 0;
      color: #217093;
      font-size: 1.1rem;
      font-weight: bold;
    }
    .site-block iframe {
      width: 100%;
      min-width: 280px;
      max-width: 400px;
      height: 166px;
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 6px;
    }
    .site-block .fallback-link {
      margin-top: 8px;
      display: none;
    }
    @media (max-width: 900px) {
      .site-block { min-width: 220px; max-width: 320px; }
      .site-block iframe { min-width: 180px; max-width: 300px; height: 120px; }
    }
    .header-btn {
      font-size: clamp(1.8rem, 3.2vw, 2.4rem);
      font-weight: 600;
      padding: 18px 36px;
      border-radius: var(--border-radius-md);
      margin: 0 8px;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }

    .header-btn.blue {
      background: var(--primary-gradient);
      color: #fff;
    }

    .header-btn.orange {
      background: var(--warning-gradient);
      color: #fff;
    }

    .header-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .header-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .header-btn:hover::before {
      left: 100%;
    }

    .header-btn:active {
      transform: translateY(0);
    }
    .content-bar {
      display: flex;
      overflow-x: auto;
      gap: 120px; /* ÌôïÏã§Ìûà ÎÑìÍ≤å Í∞ÑÍ≤© Ï°∞Ï†ï */
      padding: 18px 0 18px 18px;
      background: #fff;
      border-bottom: 2px solid #eee;
      align-items: center;
      scrollbar-width: thin;
      scrollbar-color: #bbb #eee;
    }
    .content-bar::-webkit-scrollbar { height: 12px; }
    .content-bar::-webkit-scrollbar-thumb { background: #bbb; border-radius: 8px; }
    .content-bar::-webkit-scrollbar-track { background: #eee; }
    .content-bar a, .content-bar button {
      display: flex; flex-direction: column; align-items: center; text-decoration: none; border: none; background: none; cursor: pointer;
    }
    .content-bar img, .content-bar .default-logo {
      width: 96px; height: 96px; border-radius: 22px; background: #fff; box-shadow: 0 2px 12px #0002;
      margin-bottom: 10px;
      transition: transform 0.2s;
      display: flex; align-items: center; justify-content: center;
      font-size: 3.2rem;
    }
    .content-bar img:hover, .content-bar .default-logo:hover { transform: scale(1.12); }
    .content-bar span {
      font-size: 1.05rem;
      font-weight: 600;
      color: #222;
      text-align: center;
      text-shadow: 0 1px 2px #fff, 0 0 2px #eee;
      letter-spacing: 0.2px;
      margin-top: 2px;
    }
    @media (max-width: 600px) {
      .content-bar img, .content-bar .default-logo { width: 60px; height: 60px; border-radius: 12px; font-size: 1.8rem; }
      .content-bar span { font-size: 1.05rem; }
      .header-btn { font-size: 1.1rem; padding: 8px 14px; }
    }
    #destinationIntroInBar {
      background: #f8fafc;
      border-left: 6px solid #217093;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0001;
      padding: 32px 36px 28px 32px;
      margin: 32px 0 24px 0;
      position: relative;
      max-width: 900px;
      min-width: 260px;
      color: #1a2733;
      font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', 'Noto Sans KR', sans-serif;
    }
    #destinationIntroInBar .title {
      font-size: 2.5rem !important;
      font-weight: 900;
      color: #217093;
      margin-bottom: 18px;
      text-align: left;
      letter-spacing: 0.5px;
      line-height: 1.3;
      text-shadow: 0 2px 8px #21709322;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #destinationIntroInBar .title .emoji {
      font-size: 2.6rem;
      vertical-align: middle;
      margin-right: 6px;
      filter: drop-shadow(0 1px 2px #21709333);
    }
    #destinationIntroInBar .guide-text,
    #coursePopup .course-intro,
    #coursePopup .course-block,
    #summaryBox {
      font-size: 1.15rem !important;
      line-height: 2.1;
      text-align: left;
      color: #263040;
      letter-spacing: 0.02em;
      font-family: 'Noto Sans KR', 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
    }
    #destinationIntroInBar .close-btn {
      position: absolute;
      top: 18px;
      right: 24px;
      font-size: 1.7rem;
      color: #888;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
      z-index: 10;
    }
    #destinationIntroInBar .close-btn:hover {
      color: #217093;
    }
    #coursePopup.summary-popup {
      display: none;
      position: static;
      top: auto;
      left: auto;
      width: auto;
      min-width: 0;
      max-width: 900px;
      min-height: 0;
      max-height: none;
      background: #f8fafc;
      border-left: 6px solid #27ae60;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0001;
      padding: 24px 28px 20px 28px;
      margin: 24px 0 18px 0;
      color: #1a2733;
      font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', 'Noto Sans KR', sans-serif;
      z-index: 1000;
      line-height: 1.05;
      overflow-y: visible;
      transform: none;
    }
    #coursePopup .close-btn {
      position: absolute;
      top: 18px;
      right: 24px;
      font-size: 1.7rem;
      color: #888;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
      z-index: 10;
    }
    #coursePopup .close-btn:hover {
      color: #27ae60;
    }
    #summaryBox.summary-popup {
      display: none;
      position: static;
      top: auto;
      left: auto;
      width: auto;
      min-width: 0;
      max-width: 900px;
      min-height: 0;
      max-height: none;
      background: #f8fafc;
      border-left: 6px solid #217093;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0001;
      padding: 32px 36px 28px 32px;
      margin: 32px 0 24px 0;
      color: #1a2733;
      font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', 'Noto Sans KR', sans-serif;
      z-index: 1000;
      line-height: 1.7;
      overflow-y: visible;
      transform: none;
    }
    #summaryBox .close-btn {
      position: absolute;
      top: 18px;
      right: 24px;
      font-size: 1.7rem;
      color: #888;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
      z-index: 10;
    }
    #summaryBox .close-btn:hover {
      color: #217093;
    }
    #destinationIntroInBar,
    #coursePopup.summary-popup,
    #summaryBox.summary-popup {
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0;
      box-sizing: border-box;
      word-break: break-word;
      white-space: normal;
      /* Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ïú†ÏßÄ */
    }

    .map-container, .side-tables {
      max-width: 100%;
      min-width: 0;
    }

    .header-search button,
    .course-btn,
    .summary-btn,
    .header-btn {
      font-size: 1.4rem !important;
      line-height: 1.2 !important;
      padding: 12px 24px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-width: 100px !important;
      min-height: 48px !important;
      box-sizing: border-box !important;
    }

    @media (max-width: 900px) {
      .main {
        flex-direction: column;
      }
      .map-container, .side-tables {
        width: 100%;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-title">Travel Here Service</div>
    <div class="header-search">
      <input id="destination" placeholder="ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º" style="color:#888;" />
      <button id="searchBtn">Í≤ÄÏÉâ</button>
      <button id="courseBtn" class="course-btn">Ïó¨ÌñâÏΩîÏä§Ï∂îÏ≤ú</button>
    </div>
    <button id="recommendContentBtn" class="header-btn orange">Ï∂îÏ≤ú ÏΩòÌÖêÏ∏†</button>
  </div>

  <div id="contentBar" class="content-bar" style="display:none; position:relative; flex-direction:column; align-items:flex-start;">
    <div id="destinationIntroInBar" style="display:none; width:100%; text-align:center;"></div>
    <div id="coursePopup" class="summary-popup" style="display:none;"></div>
    <div id="summaryBox" class="summary-popup" style="display:none;"></div>
    <div id="externalContentLinks">
      <a href="https://www.disneyplus.com/ko-kr" target="_blank"><img src="assets/disney+.png" alt="ÎîîÏ¶àÎãà+"><span>ÎîîÏ¶àÎãà+</span></a>
      <a href="https://www.wavve.com" target="_blank"><img src="assets/wavve.png" alt="Ïõ®Ïù¥Î∏å"><span>Ïõ®Ïù¥Î∏å</span></a>
      <a href="https://www.youtube.com" target="_blank"><img src="assets/youtube.png" alt="Ïú†ÌäúÎ∏å"><span>Ïú†ÌäúÎ∏å</span></a>
      <a href="https://watcha.com" target="_blank"><img src="assets/watcha.png" alt="ÏôìÏ±†"><span>ÏôìÏ±†</span></a>
      <a href="https://www.moazine.com/" target="_blank"><img src="assets/moazine.png" alt="Î™®ÏïÑÏßÑ"><span>Î™®ÏïÑÏßÑ</span></a>
      <a href="https://www.welaaa.com" target="_blank"><img src="assets/welaaa.png" alt="ÏúåÎùº"><span>ÏúåÎùº</span></a>
      <a href="https://www.tving.com" target="_blank"><img src="assets/tving.png" alt="Ìã∞Îπô"><span>Ìã∞Îπô</span></a>
      <a href="https://www.melon.com/" target="_blank"><img src="assets/mellon.png" alt="Î©úÎ°†"><span>Î©úÎ°†</span></a>
      <a href="https://www.netflix.com/kr" target="_blank"><img src="assets/netflix.png" alt="ÎÑ∑ÌîåÎ¶≠Ïä§"><span>ÎÑ∑ÌîåÎ¶≠Ïä§</span></a>
      <a href="https://www.genesis-music.com" target="_blank">
        <span class="default-logo" style="background:#222; color:#fff;">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="#222"/><path d="M32 16v14.5a4.5 4.5 0 1 1-2-3.7V18h-8v10.5a4.5 4.5 0 1 1-2-3.7V16h12z" fill="#fff"/></svg>
        </span>
        <span>GENESIS MUSIC</span>
      </a>
      <a href="https://www.podbbang.com" target="_blank"><img src="assets/podbbang.png" alt="ÌåüÎπµ"><span>ÌåüÎπµ</span></a>
      <a href="https://www.tjmedia.com" target="_blank"><img src="assets/tjmedia.png" alt="TJÎØ∏ÎîîÏñ¥"><span>TJÎØ∏ÎîîÏñ¥</span></a>
      <a href="https://www.genie.co.kr" target="_blank"><img src="assets/genie.png" alt="ÏßÄÎãà"><span>ÏßÄÎãà</span></a>
      <a href="https://www.bloomberg.com" target="_blank"><img src="assets/bloomberg.png" alt="Î∏îÎ£∏Î≤ÑÍ∑∏"><span>Î∏îÎ£∏Î≤ÑÍ∑∏</span></a>
      <a href="https://motvlnk.uplus.co.kr/" target="_blank"><img src="assets/mobiletvtb.png" alt="Î™®Î∞îÏùºTV"><span>Î™®Î∞îÏùºTV</span></a>
      <a href="https://www.soundcloud.com" target="_blank"><img src="assets/soundcloud.png" alt="ÏÇ¨Ïö¥ÎìúÌÅ¥ÎùºÏö∞Îìú"><span>ÏÇ¨Ïö¥ÎìúÌÅ¥ÎùºÏö∞Îìú</span></a>
      <a href="https://www.millie.co.kr" target="_blank"><img src="assets/millie.png" alt="Î∞ÄÎ¶¨ÏùòÏÑúÏû¨"><span>Î∞ÄÎ¶¨ÏùòÏÑúÏû¨</span></a>
      <a href="https://vibe.naver.com/" target="_blank"><img src="assets/vibe.png" alt="VIBE"><span>VIBE</span></a>
      <a href="https://www.airbnb.com/" target="_blank"><img src="assets/airbnb.png" alt="ÏóêÏñ¥ÎπÑÏï§ÎπÑ"><span>ÏóêÏñ¥ÎπÑÏï§ÎπÑ</span></a>
      <a href="https://www.interpark.com/" target="_blank"><img src="assets/interpark.png" alt="Ïù∏ÌÑ∞ÌååÌÅ¨"><span>Ïù∏ÌÑ∞ÌååÌÅ¨</span></a>
      <a href="https://www.letskorail.com/" target="_blank"><img src="assets/ktx.png" alt="KTX"><span>KTX</span></a>
      <a href="https://www.koreanair.com/" target="_blank"><img src="assets/korean.png" alt="ÎåÄÌïúÌï≠Í≥µ"><span>ÎåÄÌïúÌï≠Í≥µ</span></a>
      <a href="https://flyasiana.com/" target="_blank"><img src="assets/asiana.png" alt="ÏïÑÏãúÏïÑÎÇòÌï≠Í≥µ"><span>ÏïÑÏãúÏïÑÎÇòÌï≠Í≥µ</span></a>
      <a href="https://www.klook.com/" target="_blank"><img src="assets/klook.png" alt="ÌÅ¥Î£©"><span>ÌÅ¥Î£©</span></a>
      <a href="https://www.booking.com/" target="_blank"><img src="assets/booking.png" alt="Î∂ÄÌÇπÎã∑Ïª¥"><span>Î∂ÄÌÇπÎã∑Ïª¥</span></a>
      <a href="https://www.agoda.com/" target="_blank"><img src="assets/agoda.png" alt="ÏïÑÍ≥†Îã§"><span>ÏïÑÍ≥†Îã§</span></a>
    </div>
  </div>

  <div class="main">
    <div class="map-container">
      <div id="map"></div>
      <div id="summaryBox" class="summary-popup" style="display:none;"></div>
      <div id="destinationIntroBox" class="destination-intro-popup" style="display:none;"></div>
    </div>
    <div class="side-tables">
      <div class="table-section attraction-table">
        <div class="table-title">
          <button id="attractionSummaryBtn" class="summary-btn">ÏöîÏïΩ</button>
          <img src="/assets/attraction.png" alt="Í¥ÄÍ¥ëÏßÄ" style="vertical-align:middle;width:3.52rem;height:3.52rem;margin:0 10px 0 10px;">
          Í¥ÄÍ¥ëÏßÄ 10ÏÑ†
        </div>
        <div class="table-container">
          <table id="attractionTable">
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="table-section restaurant-table">
        <div class="table-title">
          <button id="restaurantSummaryBtn" class="summary-btn">ÏöîÏïΩ</button>
          <img src="/assets/restaurant.png" alt="ÎßõÏßë" style="vertical-align:middle;width:3.52rem;height:3.52rem;margin:0 10px 0 10px;">
          ÎßõÏßë 10ÏÑ†
        </div>
        <div class="table-container">
          <table id="restaurantTable">
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div id="placeDetailsBox" class="details-popup" style="display:none;"></div>
  <div id="courseMapPopup" class="course-map-popup" style="display:none;">
    <div class="course-map-content">
      <span class="close-btn" onclick="closeCourseMap()">‚úï</span>
      <h3 id="courseMapTitle" style="margin: 0 0 20px 0; color: #217093; text-align: center;">ÏΩîÏä§ ÏßÄÎèÑ</h3>
      <div id="courseMap" style="width: 100%; height: 1000px; border-radius: 8px;"></div>
    </div>
  </div>
  <script>
    const PROXY = 'https://moazine.onrender.com';
    let map, marker, destLatLng, attractions = [], restaurants = [];
    let placeMarkers = [];
    let speechVoices = [];
    let isVoicePlaying = false; // ÏùåÏÑ± Ïû¨ÏÉù ÏÉÅÌÉú Ï∂îÏ†Å
    let scWidget = null; // SoundCloud Widget Í∞ùÏ≤¥
    let courseMap = null; // ÏΩîÏä§ ÏßÄÎèÑ Ïù∏Ïä§ÌÑ¥Ïä§
    let courseData = []; // ÏΩîÏä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
    let courseMarkers = []; // ÏΩîÏä§ ÏßÄÎèÑ ÎßàÏª§ Î∞∞Ïó¥
    // Ï∂îÏ≤úÏΩòÌÖêÏ∏† Î≤ÑÌäº ÌÜ†Í∏Ä ÏÉÅÌÉú Î≥ÄÏàò Ï∂îÍ∞Ä
    let isRecommendContentActive = false;

    function loadVoices() {
      speechVoices = window.speechSynthesis.getVoices();
    }
    loadVoices();
    if (window.speechSynthesis.onvoiceschanged !== undefined) {
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }

    // Google Maps JS API ÎèôÏ†Å Î°úÎìú
    async function loadGoogleMapAPI() {
      const response = await fetch(`${PROXY}/map-key`);
      const { apiKey } = await response.json();
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap&libraries=places`;
      script.async = true;
      document.head.appendChild(script);
    }

    window.initMap = function() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 37.5665, lng: 126.9780 },
        zoom: 14
      });
      // Ï≤´ ÏßÑÏûÖ Ïãú ÌòÑÏû¨ ÏúÑÏπòÎ°ú ÏûêÎèô Í≤ÄÏÉâ
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude, lng = pos.coords.longitude;
          map.setCenter({ lat, lng });
          if (marker) marker.setMap(null);
          marker = new google.maps.Marker({ position: { lat, lng }, map: map, title: 'ÌòÑÏû¨ ÏúÑÏπò', icon: { url: '/assets/current.png', scaledSize: new google.maps.Size(48, 48) } });
          destLatLng = { lat, lng };
          document.getElementById('destination').value = '';
          document.getElementById('destination').placeholder = 'ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º';
          document.getElementById('destination').style.color = '#888';
          loadPlaces(true);
        }, () => {
          // ÏúÑÏπò Í∂åÌïú Í±∞Î∂Ä Ïãú ÏÑúÏö∏ Í∏∞Î≥∏
          loadPlaces(true);
        });
      } else {
        loadPlaces(true);
      }
    };

    document.getElementById('destination').onfocus = function() {
      this.style.color = '#222';
      if (this.value === '') this.placeholder = '';
    };
    document.getElementById('destination').onblur = function() {
      if (this.value === '') {
        this.placeholder = 'ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º';
        this.style.color = '#888';
      }
    };

    document.getElementById('searchBtn').onclick = function() {
      const dest = document.getElementById('destination').value;
      
      // Î™©Ï†ÅÏßÄÍ∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ ÌòÑÏû¨ ÏúÑÏπòÏóêÏÑú Í≤ÄÏÉâ
      if (!dest) {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude, lng = pos.coords.longitude;
            destLatLng = { lat, lng };
            map.setCenter(destLatLng);
            if (marker) marker.setMap(null);
            marker = new google.maps.Marker({ position: destLatLng, map: map, title: 'ÌòÑÏû¨ ÏúÑÏπò', icon: { url: '/assets/current.png', scaledSize: new google.maps.Size(48, 48) } });
            document.getElementById('destination').value = '';
            document.getElementById('destination').placeholder = 'ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º';
            document.getElementById('destination').style.color = '#888';
            loadPlaces(true);
            // Î™©Ï†ÅÏßÄ ÏïàÎÇ¥ ÏòÅÏó≠/ÏΩòÌÖêÏ∏†Î∞î ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            document.getElementById('contentBar').style.display = 'none';
            document.getElementById('destinationIntroInBar').style.display = 'none';
            document.getElementById('externalContentLinks').style.display = 'flex';
            if ('speechSynthesis' in window) window.speechSynthesis.cancel();
          }, () => {
            alert('ÌòÑÏû¨ ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
          });
        } else {
          alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî ÌòÑÏû¨ ÏúÑÏπòÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
        }
        return;
      }
      
      // 'ÌòÑÏû¨ÏúÑÏπò', 'ÌòÑÏúÑÏπò', 'Ïó¨Í∏∞', 'Ïù¥Í≥≥' ÏûÖÎ†• Ïãú ÌòÑÏû¨ ÏúÑÏπòÎ°ú Í≤ÄÏÉâ
      const currentKeywords = ['ÌòÑÏû¨ÏúÑÏπò', 'ÌòÑÏúÑÏπò', 'Ïó¨Í∏∞', 'Ïù¥Í≥≥'];
      if (currentKeywords.includes(dest.trim().replace(/\s/g, ''))) {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude, lng = pos.coords.longitude;
            destLatLng = { lat, lng };
            map.setCenter(destLatLng);
            if (marker) marker.setMap(null);
            marker = new google.maps.Marker({ position: destLatLng, map: map, title: 'ÌòÑÏû¨ ÏúÑÏπò', icon: { url: '/assets/current.png', scaledSize: new google.maps.Size(48, 48) } });
            document.getElementById('destination').value = '';
            document.getElementById('destination').placeholder = 'ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º';
            document.getElementById('destination').style.color = '#888';
            loadPlaces(true);
            // Î™©Ï†ÅÏßÄ ÏïàÎÇ¥ ÏòÅÏó≠/ÏΩòÌÖêÏ∏†Î∞î ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            document.getElementById('contentBar').style.display = 'none';
            document.getElementById('destinationIntroInBar').style.display = 'none';
            document.getElementById('externalContentLinks').style.display = 'flex';
            if ('speechSynthesis' in window) window.speechSynthesis.cancel();
          }, () => {
            alert('ÌòÑÏû¨ ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
          });
        } else {
          alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî ÌòÑÏû¨ ÏúÑÏπòÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
        }
        return;
      }
      // ÏùºÎ∞ò Ï£ºÏÜå Í≤ÄÏÉâ
      fetch(`${PROXY}/geocode?query=${encodeURIComponent(dest)}`)
      .then(res => res.json())
      .then(data => {
        if (data.results && data.results.length > 0) {
          const loc = data.results[0].geometry.location;
          const placeName = data.results[0].formatted_address;
          destLatLng = { lat: loc.lat, lng: loc.lng };
          map.setCenter(destLatLng);
          if (marker) marker.setMap(null);
          marker = new google.maps.Marker({ position: destLatLng, map: map, title: 'Î™©Ï†ÅÏßÄ' });
          document.getElementById('destination').style.color = '#222';
          // Î™©Ï†ÅÏßÄ ÏïàÎÇ¥ ÌëúÏãú Î∞è ÏΩòÌÖêÏ∏†Î∞î ÏÉÅÌÉú
          document.getElementById('contentBar').style.display = 'flex';
          document.getElementById('destinationIntroInBar').style.display = 'block';
          document.getElementById('externalContentLinks').style.display = 'none';
          showDestinationIntro(dest, placeName, destLatLng);
          loadPlaces(false);
        } else {
          alert('Î™©Ï†ÅÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }
      })
      .catch(error => {
        console.error('ÏßÄÏò§ÏΩîÎî© ÏóêÎü¨:', error);
        alert('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
      });
    };

    // Í≤ÄÏÉâÏ∞ΩÏóêÏÑú ÏóîÌÑ∞ÌÇ§ ÏûÖÎ†• ÏãúÏóêÎèÑ Í≤ÄÏÉâ ÎèôÏûë
    document.getElementById('destination').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        document.getElementById('searchBtn').click();
      }
    });

    function clearPlaceMarkers() {
      placeMarkers.forEach(m => m.setMap(null));
      placeMarkers = [];
    }

    function loadPlaces(isCurrentLocation) {
      clearPlaceMarkers();
      let url = `${PROXY}/places?lat=${destLatLng.lat}&lng=${destLatLng.lng}&radius=5000`;
      
      // Î™©Ï†ÅÏßÄ Ï†ïÎ≥¥Í∞Ä ÏûàÏúºÎ©¥ Ï†ÑÎã¨
      const destinationInput = document.getElementById('destination');
      if (destinationInput && destinationInput.value.trim()) {
        url += `&destination=${encodeURIComponent(destinationInput.value.trim())}`;
      }
      
      fetch(url)
      .then(res => res.json())
      .then(data => {
        attractions = data.attractions || [];
        restaurants = data.restaurants || [];
        renderTable('attractionTable', attractions, 'Í¥ÄÍ¥ëÏßÄ');
        renderTable('restaurantTable', restaurants, 'ÎßõÏßë');
        // Í¥ÄÍ¥ëÏßÄ/ÎßõÏßë ÎßàÏª§ ÌëúÏãú (ÏïÑÏù¥ÏΩò Ï†ÅÏö©)
        attractions.forEach(place => {
          if (place.geometry && place.geometry.location) {
            const m = new google.maps.Marker({
              position: place.geometry.location,
              map: map,
              title: place.name,
              icon: {
                url: '/assets/attraction.png',
                scaledSize: new google.maps.Size(48, 48)
              }
            });
            m.addListener('click', function() {
              window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name)}`,'_blank');
            });
            placeMarkers.push(m);
          }
        });
        restaurants.forEach(place => {
          if (place.geometry && place.geometry.location) {
            const m = new google.maps.Marker({
              position: place.geometry.location,
              map: map,
              title: place.name,
              icon: {
                url: '/assets/restaurant.png',
                scaledSize: new google.maps.Size(48, 48)
              }
            });
            m.addListener('click', function() {
              window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name)}`,'_blank');
            });
            placeMarkers.push(m);
          }
        });
        // Í≤ÄÏÉâÏ∞Ω ÌëúÏãú
        if (isCurrentLocation) {
          document.getElementById('destination').value = '';
          document.getElementById('destination').placeholder = 'ÌòÑÏû¨ ÏúÑÏπò Í≤ÄÏÉâ Í≤∞Í≥º';
          document.getElementById('destination').style.color = '#888';
        }
      });
    }

    function renderTable(tableId, list, type) {
      const tbody = document.getElementById(tableId).querySelector('tbody');
      let html = '';
      const maxRows = 10;

      if (list.length === 0) {
        // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Îïå 10Í∞úÏùò Îπà Ìï≠Î™© ÌëúÏãú
        for (let i = 0; i < maxRows; i++) {
          html += `<tr><td style='width:48px;text-align:center;color:#888;white-space:nowrap;'>${i+1}.</td><td style='color:#888;'>ÌòÑÏû¨ ÏúÑÏπòÏóêÏÑú Ï∂îÏ≤úÌï† Í≥≥Ïù¥ ÏóÜÏäµÎãàÎã§</td><td class='score'></td></tr>`;
        }
      } else {
        // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏùÑ Îïå ÏµúÎåÄ 10Í∞úÎßå ÌëúÏãú
        html = list.slice(0, maxRows).map((item, i) =>
          `<tr class="clickable" onclick="showPlaceInfo('${type}', '${item.place_id}')">
            <td style="width:48px;text-align:center;white-space:nowrap;">${i+1}.</td>
            <td>${item.name}</td>
            <td class="score">${item.rating ? item.rating.toFixed(1) + 'Ï†ê' : '-'}</td>
          </tr>`
        ).join('');
        // 10Í∞ú ÎØ∏ÎßåÏùº Îïå Îπà Ìï≠Î™©ÏúºÎ°ú Ï±ÑÏõÄ
        if (list.length < maxRows) {
          for (let i = list.length; i < maxRows; i++) {
            html += `<tr><td style='width:48px;text-align:center;color:#888;white-space:nowrap;'>${i+1}.</td><td style='color:#888;'>ÌòÑÏû¨ ÏúÑÏπòÏóêÏÑú Ï∂îÏ≤úÌï† Í≥≥Ïù¥ ÏóÜÏäµÎãàÎã§</td><td class='score'></td></tr>`;
          }
        }
      }
      tbody.innerHTML = html;
    }

    window.showPlaceInfo = function(type, placeId) {
      if (!placeId) {
        alert('Ïû•ÏÜå Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }

      const box = document.getElementById('placeDetailsBox');
      box.innerHTML = `<div style="padding: 40px; text-align:center;">ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>`;
      box.style.display = 'block';

      fetch(`${PROXY}/place-details?place_id=${placeId}`)
        .then(res => res.json())
        .then(details => {
          if (details.error) throw new Error(details.error);
          
          let contentHtml = `<span class='close-btn' onclick="closeDetailsBox()">‚úï</span>`;
          
          let detailsHtml = `<div class="details-popup-content">`;
          detailsHtml += `<div class="details-popup-header">${details.name || 'Ïù¥Î¶Ñ Ï†ïÎ≥¥ ÏóÜÏùå'}</div>`;
          
          const detailsContent = [
            { icon: 'üìç', text: 'Ï£ºÏÜå', value: details.formatted_address },
            { icon: '‚≠ê', text: 'ÌèâÏ†ê', value: details.rating ? `${details.rating.toFixed(1)}Ï†ê` : null },
            { icon: 'üìû', text: 'Ïó∞ÎùΩÏ≤ò', value: details.formatted_phone_number, link: `tel:${details.formatted_phone_number}` },
            { icon: 'üí∞', text: 'Í∞ÄÍ≤©ÎåÄ', value: details.price_level ? '‚Ç©'.repeat(details.price_level) : null },
            { icon: 'üåê', text: 'ÏõπÏÇ¨Ïù¥Ìä∏', value: details.website, link: details.website }
          ];

          detailsContent.forEach(item => {
            if (item.value) {
              detailsHtml += `
                <div class="detail-item">
                  <div class="label">
                    <span class="icon">${item.icon}</span>
                    <span>${item.text}</span>
                  </div>
                  <div class="value">${item.link ? `<a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.value}</a>` : item.value}</div>
                </div>`;
            }
          });

          // ÏõπÏÇ¨Ïù¥Ìä∏Í∞Ä ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå Î©îÎâ¥/ÏûÖÏû•Î£å ÏïàÎÇ¥ Î¨∏Íµ¨ Ï∂îÍ∞Ä
          if (details.website) {
            const guidanceText = `ÏûêÏÑ∏Ìïú ${type === 'ÎßõÏßë' ? 'Î©îÎâ¥' : 'ÏûÖÏû•Î£å'} Ï†ïÎ≥¥Îäî ÏúÑ Í≥µÏãù ÏõπÏÇ¨Ïù¥Ìä∏Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.`;
            detailsHtml += `
              <div class="detail-item">
                <div class="label">
                  <span class="icon">‚ÑπÔ∏è</span>
                  <span>ÏïàÎÇ¥</span>
                </div>
                <div class="value"><small>${guidanceText}</small></div>
              </div>`;
          }

          detailsHtml += '</div>';

          if (details.reviews && details.reviews.length > 0) {
            detailsHtml += `<div class="reviews-section details-popup-content">`;
            detailsHtml += `
              <div class="detail-item">
                <div class="label" style="color: #217093;">
                  <span class="icon">üó£Ô∏è</span>
                  <span>Î∞©Î¨∏Ïûê Î¶¨Î∑∞</span>
                </div>
              </div>`;
            details.reviews.slice(0, 2).forEach(review => {
              detailsHtml += `<div class="review">
                <div><span class="review-author">${review.author_name}</span> (${review.relative_time_description})</div>
                <p style="margin: 5px 0 0; white-space: pre-wrap;">${review.text}</p>
              </div>`;
            });
            detailsHtml += `</div>`;
          }
          
          box.innerHTML = contentHtml + detailsHtml;
        })
        .catch(err => {
          console.error('Failed to get place details:', err);
          box.innerHTML = `<span class='close-btn' onclick="closeDetailsBox()">‚úï</span><div style="padding: 40px; text-align:center;">ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>`;
        });
    };

    function closeDetailsBox() {
      document.getElementById('placeDetailsBox').style.display = 'none';
    }

    // ÏöîÏïΩ Ï†ïÎ≥¥ Î≥¥Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
    document.getElementById('attractionSummaryBtn').onclick = function() {
      showOnlyContentBarPopup('summaryBox');
      showSummary('Í¥ÄÍ¥ëÏßÄ', attractions);
    };
    document.getElementById('restaurantSummaryBtn').onclick = function() {
      showOnlyContentBarPopup('summaryBox');
      showSummary('ÎßõÏßë', restaurants);
    };

    function showSummary(type, list) {
      if (!list || list.length === 0) {
        showSummaryBox('ÏöîÏïΩÌï† Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
        return;
      }
      showSummaryBox('ÏöîÏïΩ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...');
      fetch('https://moazine.onrender.com/summarize', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ places: list, type })
      })
      .then(res => res.json())
      .then(data => {
        showSummaryBox(data.summary || 'ÏöîÏïΩ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.');
      })
      .catch(() => showSummaryBox('ÏöîÏïΩ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.'));
    }

    function getSpeechText(text) {
      // 1. Ï§Ñ ÏãúÏûëÏùò Î≤àÌò∏Î•º ÌïúÍµ≠Ïñ¥ ÏÑúÏàòÎ°ú Î®ºÏ†Ä Î≥ÄÌôòÌï©ÎãàÎã§. (Î©ÄÌã∞ÎùºÏù∏ `m` ÌîåÎûòÍ∑∏ ÏÇ¨Ïö©)
      let speech = text.replace(/^1\./gm, 'Ï≤´Î≤àÏß∏')
                       .replace(/^2\./gm, 'ÎëêÎ≤àÏß∏')
                       .replace(/^3\./gm, 'ÏÖãÎ≤àÏß∏')
                       .replace(/^4\./gm, 'ÎÑ§Î≤àÏß∏')
                       .replace(/^5\./gm, 'Îã§ÏÑØÎ≤àÏß∏');

      // 2. Í¥ÑÌò∏ÏôÄ Í¥ÑÌò∏ ÏïàÏùò ÎÇ¥Ïö©, Í∑∏ Ïô∏ Í∏∞Ìò∏Î•º Ï†ïÎ¶¨Ìï©ÎãàÎã§.
      speech = speech
        .replace(/\([^\)]*\)/g, '') // ( ... ) Ï†ÑÏ≤¥ Ï†úÍ±∞
        .replace(/[\[\]\-¬∑*=_~^|#@$%&+=‚Üí‚Ä¢‚ñ™Ô∏éüéØüåüüéí‚úàÔ∏èüëç‚úÖ‚úîüíØ‚ù£Ô∏è]/g, ' ') // ÏùåÏÑ± Ï∂úÎ†•Ïóê Î∂àÌïÑÏöîÌïú ÌäπÏàòÍ∏∞Ìò∏ Î∞è Ïù¥Î™®ÏßÄ Ï†úÍ±∞
        .replace(/:/g, 'ÏùÄ')
        .replace(/\//g, ' ÎòêÎäî ')
        .replace(/ÌèâÏ†ê/g, 'ÌèâÏ†êÏùÄ');

      // 3. Ïã§ÏàòÌòï Ï†êÏàòÎ•º ÌïúÍµ≠Ïñ¥Î°ú Î≥ÄÌôòÌï©ÎãàÎã§. (Ïòà: 4.5Ï†ê -> 4Ï†ê5)
      speech = speech.replace(/(\d+)\.(\d+)Ï†ê/g, '$1Ï†ê$2');
      
      // 4. ÏÑúÏàòÎÇò ÌèâÏ†êÏúºÎ°ú Ï≤òÎ¶¨ÎêòÏßÄ ÏïäÏùÄ, Î≥∏Î¨∏Ïóê ÎÇ®ÏùÄ 'Ïà´Ïûê.' ÌòïÏãùÏùò Ï†êÏùÑ Ï†úÍ±∞Ìï©ÎãàÎã§.
      speech = speech.replace(/(\d)\./g, '$1');

      // 5. ÎßàÏßÄÎßâÏúºÎ°ú Ï§ÑÎ∞îÍøàÍ≥º Ïó¨Îü¨ Í≥µÎ∞±ÏùÑ ÌïòÎÇòÏùò Í≥µÎ∞±ÏúºÎ°ú ÌÜµÏùºÌï©ÎãàÎã§.
      speech = speech.replace(/\n/g, ' ').replace(/\s{2,}/g, ' ').trim();
        
      return speech;
    }

    function showSummaryBox(text) {
      const box = document.getElementById('summaryBox');
      box.innerHTML = `<button class='close-btn' onclick="closeSummaryBox()">‚úï</button>` + text;
      box.style.display = 'block';
      // ÏùåÏÑ± Ï∂úÎ†• (Ïó¨Ìñâ Í∞ÄÏù¥Îìú Ïù∏Ìä∏Î°ú, ÏòµÏÖò Ï°∞Ï†ï)
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel(); // Í∏∞Ï°¥ ÏùåÏÑ± Ï§ëÏßÄ
        const speechText = getSpeechText(text);
        const utter = new SpeechSynthesisUtterance(speechText);
        utter.lang = 'ko-KR';
        utter.rate = 0.9; // Ï°∞Í∏à Îçî Ï≤úÏ≤úÌûà
        utter.pitch = 1; // ÏûêÏó∞Ïä§Îü¨Ïö¥ ÎÜíÏù¥
        utter.volume = 3.0; // ÏµúÎåÄ Î≥ºÎ•®Ïùò 3Î∞∞Î°ú ÏÑ§Ï†ï (Í∏∞Ï°¥ 2.0ÏóêÏÑú Ï¶ùÍ∞Ä)
        // ÏûêÏó∞Ïä§Îü¨Ïö¥ ÌïúÍµ≠Ïñ¥ voice ÏÑ†ÌÉù
        const koVoice = speechVoices.find(v => v.lang === 'ko-KR' && v.name.includes('Google'));
        if (koVoice) utter.voice = koVoice;
        // ÏùåÏÑ± Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        setupSpeechEvents(utter);
        window.speechSynthesis.speak(utter);
      }
    }

    function closeSummaryBox() {
      if (isRecommendContentActive) {
        showOnlyContentBarPopup('externalContentLinks');
      } else {
        showOnlyContentBarPopup('none');
      }
      if ('speechSynthesis' in window) window.speechSynthesis.cancel();
      restoreMusicPlayer();
    }

    function showDestinationIntro(searchQuery, placeName, latLng) {
      // contentBar intro ÏòÅÏó≠Ïóê ÌëúÏãú
      const introBox = document.getElementById('destinationIntroInBar');
      introBox.innerHTML = `
        <div class="title"><span class="emoji">üéØ</span> <span>${searchQuery} Ïó¨Ìñâ Í∞ÄÏù¥Îìú</span></div>
        <div class="guide-text">Í∞ÄÏù¥Îìú Ï†ïÎ≥¥Î•º ÏÉùÏÑ±ÌïòÎäî Ï§ëÏûÖÎãàÎã§... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</div>
        <button class='close-btn' onclick="closeDestinationIntroInBar()">‚úï</button>
      `;
      introBox.style.display = 'block';
      document.getElementById('externalContentLinks').style.display = 'none';
      // ÌåùÏóÖÏùÄ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
      // document.getElementById('destinationIntroBox').style.display = 'none';

      fetch(`${PROXY}/generate-intro`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: searchQuery, address: placeName, lat: latLng.lat, lng: latLng.lng })
      })
      .then(res => res.json())
      .then(data => {
        // Ï§ÑÎ∞îÍøà ÏóÜÏù¥ Ìïú Î¨∏Îã®ÏúºÎ°ú ÌëúÏãú
        const introText = data.intro.replace(/\n/g, ' ');
        const guideTextElement = introBox.querySelector('.guide-text');
        if (guideTextElement) {
          guideTextElement.innerHTML = introText;
        }
        // ÏùåÏÑ± Ï∂úÎ†•
        if ('speechSynthesis' in window) {
          window.speechSynthesis.cancel();
          const speechText = getDestinationSpeechText(introText);
          const utter = new SpeechSynthesisUtterance(speechText);
          utter.lang = 'ko-KR';
          utter.rate = 0.9;
          utter.pitch = 1;
          utter.volume = 3.0;
          const koVoice = speechVoices.find(v => v.lang === 'ko-KR' && v.name.includes('Google'));
          if (koVoice) utter.voice = koVoice;
          setupSpeechEvents(utter);
          window.speechSynthesis.speak(utter);
        }
      })
      .catch(err => {
        console.error('Failed to get destination intro:', err);
        const guideTextElement = introBox.querySelector('.guide-text');
        if (guideTextElement) {
          guideTextElement.innerHTML = 'Í∞ÄÏù¥Îìú Ï†ïÎ≥¥ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.';
        }
      });
      showOnlyContentBarPopup('destinationIntroInBar');
    }

    function getDestinationSpeechText(text) {
      // HTML ÌÉúÍ∑∏ Ï†úÍ±∞ Î∞è ÏùåÏÑ±Ïö© ÌÖçÏä§Ìä∏ Ï†ïÎ¶¨
      let speech = text.replace(/<[^>]*>/g, '') // HTML ÌÉúÍ∑∏ Ï†úÍ±∞
                       .replace(/[\[\]\-¬∑*=_~^|#@$%&+=‚Üí‚Ä¢‚ñ™Ô∏éüéØüåüüéí‚úàÔ∏èüëç‚úÖ‚úîüíØ‚ù£Ô∏è]/g, ' ') // ÏùåÏÑ± Ï∂úÎ†•Ïóê Î∂àÌïÑÏöîÌïú ÌäπÏàòÍ∏∞Ìò∏ Î∞è Ïù¥Î™®ÏßÄ Ï†úÍ±∞
                       .replace(/\n/g, ' ') // Ï§ÑÎ∞îÍøàÏùÑ Í≥µÎ∞±ÏúºÎ°ú
                       .replace(/\s{2,}/g, ' ') // Ïó¨Îü¨ Í≥µÎ∞±ÏùÑ ÌïòÎÇòÎ°ú
                       .trim();
      
      return speech;
    }

    function closeDestinationIntroInBar() {
      if (isRecommendContentActive) {
        showOnlyContentBarPopup('externalContentLinks');
      } else {
        showOnlyContentBarPopup('none');
      }
      if ('speechSynthesis' in window) window.speechSynthesis.cancel();
    }

    // Ï∂îÏ≤úÏΩîÏä§ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
    document.getElementById('courseBtn').onclick = function() {
      showCoursePopup();
    };

    function showCoursePopup() {
      // ÏùåÏÑ± ÏïàÎÇ¥ Î®ºÏ†Ä Ï∂úÎ†•
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance("Ï∂îÏ≤úÏΩîÏä§ 3Í∞úÎ•º Ï£ºÎ≥Ä Í¥ÄÍ¥ëÏßÄÏôÄ ÎßõÏßëÏùÑ ÏÑ†Ï†ïÌïòÏó¨ Ïó¨Ìñâ ÏΩîÏä§Î•º ÏÑ†Ï†ïÌï¥ ÎìúÎ¶ΩÎãàÎã§");
        utter.lang = 'ko-KR';
        utter.rate = 0.9;
        utter.pitch = 1;
        utter.volume = 3.0;
        const koVoice = speechVoices.find(v => v.lang === 'ko-KR' && v.name.includes('Google'));
        if (koVoice) utter.voice = koVoice;
        setupSpeechEvents(utter);
        window.speechSynthesis.speak(utter);
      }

      if ((!attractions || attractions.length === 0) && (!restaurants || restaurants.length === 0)) {
        showCourseBox('Ï∂îÏ≤úÌï† ÏΩîÏä§ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      // Î™©Ï†ÅÏßÄ ÏÜåÍ∞ú Ï†ïÎ≥¥Î•º Î™ÖÏãúÏ†ÅÏúºÎ°ú Ïà®ÍπÄ
      document.getElementById('destinationIntroInBar').style.display = 'none';
      
      showCourseBox('Ï∂îÏ≤ú ÏΩîÏä§Î•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§...');
      fetch('https://moazine.onrender.com/generate-course', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ attractions, restaurants })
      })
      .then(res => res.json())
      .then(data => {
        showCourseBox(data.course || 'Ï∂îÏ≤ú ÏΩîÏä§Î•º Í∞ÄÏ†∏Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.');
      })
      .catch(() => showCourseBox('Ï∂îÏ≤ú ÏΩîÏä§Î•º Í∞ÄÏ†∏Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.'));
    }

    function showCourseBox(text) {
      const box = document.getElementById('coursePopup');
      
      // Î™©Ï†ÅÏßÄ ÏÜåÍ∞ú Ï†ïÎ≥¥Î•º Î™ÖÏãúÏ†ÅÏúºÎ°ú Ïà®ÍπÄ
      document.getElementById('destinationIntroInBar').style.display = 'none';
      
      // Gemini ÏùëÎãµÏùÑ 3Í∞ÄÏßÄ ÏΩîÏä§Î°ú Î∂ÑÎ¶¨ (###, --- Îì±ÏúºÎ°ú Íµ¨Î∂Ñ)
      let courseHtml = '';
      const courseTitles = ['Ï≤´Î≤àÏß∏ ÏΩîÏä§', 'ÎëêÎ≤àÏß∏ ÏΩîÏä§', 'ÏÑ∏Î≤àÏß∏ ÏΩîÏä§'];
      const blocks = text.split(/(?:^|\n)[#\-]{2,}[^\n]*\n?/g).map(s => s.trim()).filter(Boolean);
      
      // ÏΩîÏä§ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
      courseData = [];
      
      // ÎßàÌÅ¨Îã§Ïö¥ Î¨∏Î≤ï Ï†úÍ±∞ Ìï®Ïàò
      function cleanMarkdown(text) {
        return text
          .replace(/\*\*/g, '') // ** Ï†úÍ±∞
          .replace(/\*/g, '')   // * Ï†úÍ±∞
          .replace(/\n/g, '<br>'); // Ï§ÑÎ∞îÍøàÏùÑ <br>Î°ú Î≥ÄÌôò
      }
      
      // ÏïàÎÇ¥Î¨∏Íµ¨(Ïù∏Ìä∏Î°ú)Í∞Ä ÏûàÎäî Í≤ΩÏö∞ Ï≤´ Î∏îÎ°ùÏù¥ Ïù∏Ìä∏Î°ú, ÎÇòÎ®∏ÏßÄÍ∞Ä ÏΩîÏä§
      if (blocks.length > 2) {
        const intro = cleanMarkdown(blocks[0]);
        const courses = blocks.slice(1);
        courseHtml = `<div class="course-intro">${intro}</div>` +
          courses.map((block, idx) => {
            const title = courseTitles[idx] || `ÏΩîÏä§ ${idx+1}`;
            // ÏΩîÏä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (ÏõêÎ≥∏ ÌÖçÏä§Ìä∏Îäî ÎßàÌÅ¨Îã§Ïö¥ Ï†úÍ±∞ Ï†ÑÏóê Ï†ÄÏû•)
            courseData.push({
              title: title,
              content: block,
              places: extractPlacesFromCourse(block, idx)
            });
            return `<div class="course-block course-${idx+1}">
              <div class="course-title">
                ${title}
                <button class="route-btn" onclick="showCourseMap(${idx})">üó∫Ô∏è Í∏∏ÏïàÎÇ¥</button>
              </div>
              ${cleanMarkdown(block)}
            </div>`;
          }).join('');
      } else if (blocks.length > 1) {
        courseHtml = blocks.map((block, idx) => {
          const title = courseTitles[idx] || `ÏΩîÏä§ ${idx+1}`;
          // ÏΩîÏä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (ÏõêÎ≥∏ ÌÖçÏä§Ìä∏Îäî ÎßàÌÅ¨Îã§Ïö¥ Ï†úÍ±∞ Ï†ÑÏóê Ï†ÄÏû•)
          courseData.push({
            title: title,
            content: block,
            places: extractPlacesFromCourse(block, idx)
          });
          return `<div class="course-block course-${idx+1}">
            <div class="course-title">
              ${title}
              <button class="route-btn" onclick="showCourseMap(${idx})">üó∫Ô∏è Í∏∏ÏïàÎÇ¥</button>
            </div>
            ${cleanMarkdown(block)}
          </div>`;
        }).join('');
      } else {
        // ÏΩîÏä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (ÏõêÎ≥∏ ÌÖçÏä§Ìä∏Îäî ÎßàÌÅ¨Îã§Ïö¥ Ï†úÍ±∞ Ï†ÑÏóê Ï†ÄÏû•)
        courseData.push({
          title: 'Ï≤´Î≤àÏß∏ ÏΩîÏä§',
          content: text,
          places: extractPlacesFromCourse(text, 0)
        });
        courseHtml = `<div class="course-block">
          <div class="course-title">
            Ï≤´Î≤àÏß∏ ÏΩîÏä§
            <button class="route-btn" onclick="showCourseMap(0)">üó∫Ô∏è Í∏∏ÏïàÎÇ¥</button>
          </div>
          ${cleanMarkdown(text)}
        </div>`;
      }
      box.innerHTML = `<span class='close-btn' onclick="closeCourseBox()">‚úï</span>` + courseHtml;
      showOnlyContentBarPopup('coursePopup');
    }

    function closeCourseBox() {
      if (isRecommendContentActive) {
        showOnlyContentBarPopup('externalContentLinks');
      } else {
        showOnlyContentBarPopup('none');
      }
      if ('speechSynthesis' in window) window.speechSynthesis.cancel();
      restoreMusicPlayer();
    }
    // ÏùåÏÑ± Ìï©ÏÑ± Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
    function setupSpeechEvents(utterance) {
      utterance.onstart = function() {
        dimMusicPlayer();
      };
      utterance.onend = function() {
        restoreMusicPlayer();
      };
      utterance.onerror = function() {
        restoreMusicPlayer();
      };
    }

    // ÏùåÏïÖ ÌîåÎ†àÏù¥Ïñ¥ ÏãúÍ∞ÅÏ†Å Ï†úÏñ¥ Ìï®ÏàòÎì§
    function dimMusicPlayer() {
      const iframe = document.getElementById('scPlayer');
      if (iframe && !isVoicePlaying) {
        isVoicePlaying = true;
        // iframeÏùÑ ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú Ïñ¥Îë°Í≤å ÌëúÏãúÌïòÏó¨ ÏùåÏÑ±Ïù¥ Ïû¨ÏÉù Ï§ëÏûÑÏùÑ ÎÇòÌÉÄÎÉÑ
        iframe.style.opacity = '0.3';
        iframe.style.filter = 'grayscale(50%)';
        iframe.style.transition = 'all 0.3s ease';
      }
    }

    function restoreMusicPlayer() {
      const iframe = document.getElementById('scPlayer');
      if (iframe && isVoicePlaying) {
        isVoicePlaying = false;
        // ÏõêÎûò Ïä§ÌÉÄÏùºÎ°ú Î≥µÏõê
        iframe.style.opacity = '1';
        iframe.style.filter = 'none';
      }
    }

    // ÏΩîÏä§ÏóêÏÑú Ïû•ÏÜåÎ™Ö Ï∂îÏ∂úÌïòÎäî Ìï®Ïàò
    function extractPlacesFromCourse(courseText, courseIndex) {
      const places = [];
      const allPlaces = [...attractions, ...restaurants];
      
      console.log('ÏΩîÏä§ ÌÖçÏä§Ìä∏:', courseText);
      console.log('Ï†ÑÏ≤¥ Ïû•ÏÜå Î™©Î°ù:', allPlaces.map(p => p.name));
      
      // ÏΩîÏä§ ÌÖçÏä§Ìä∏ÏóêÏÑú Ïû•ÏÜåÎ™Ö Ï∞æÍ∏∞ (Ïó¨Îü¨ Ìå®ÌÑ¥ ÏãúÎèÑ)
      const patterns = [
        // ÏãúÍ∞Ñ Ìå®ÌÑ¥: üïò 09:00 ‚Äì **Ïû•ÏÜåÎ™Ö** ÎòêÎäî üïò 09:00 - Ïû•ÏÜåÎ™Ö
        /üïò\s*(\d{1,2}:\d{2})\s*[‚Äì-]\s*(\*\*)?([^*\n]+?)(\*\*)?/g,
        // Î≤àÌò∏ Ìå®ÌÑ¥: 1. **Ïû•ÏÜåÎ™Ö** ÎòêÎäî 1. Ïû•ÏÜåÎ™Ö
        /(\d+)\.\s*(\*\*)?([^*\n]+?)(\*\*)?/g,
        // Îã®Ïàú Î≥ºÎìú Ìå®ÌÑ¥: **Ïû•ÏÜåÎ™Ö**
        /(\*\*)([^*\n]+?)(\*\*)/g,
        // ÏãúÍ∞Ñ Ìå®ÌÑ¥ (Îã§ÏñëÌïú ÌòïÏãù): 09:00 Ïû•ÏÜåÎ™Ö, 09:00-Ïû•ÏÜåÎ™Ö Îì±
        /(\d{1,2}:\d{2})\s*[‚Äì-]?\s*([^\n]+?)(?=\n|$)/g
      ];
      
      let visitOrder = 1;
      let foundPlaces = new Set(); // Ï§ëÎ≥µ Î∞©ÏßÄ
      
      patterns.forEach((pattern, patternIndex) => {
        let match;
        while ((match = pattern.exec(courseText)) !== null) {
          let placeName, time = null;
          
          if (patternIndex === 0) {
            // ÏãúÍ∞Ñ Ìå®ÌÑ¥ (üïò Ìè¨Ìï®)
            time = match[1];
            placeName = match[3].trim();
          } else if (patternIndex === 1) {
            // Î≤àÌò∏ Ìå®ÌÑ¥
            visitOrder = parseInt(match[1]);
            placeName = match[3].trim();
          } else if (patternIndex === 2) {
            // Îã®Ïàú Î≥ºÎìú Ìå®ÌÑ¥
            placeName = match[2].trim();
          } else if (patternIndex === 3) {
            // ÏãúÍ∞Ñ Ìå®ÌÑ¥ (üïò ÏóÜÏùå)
            time = match[1];
            placeName = match[2].trim();
          }
          
          // Ïù¥ÎØ∏ Ï∞æÏùÄ Ïû•ÏÜåÎäî Í±¥ÎÑàÎõ∞Í∏∞
          if (foundPlaces.has(placeName)) continue;
          
          console.log('Ï∞æÏùÄ Ïû•ÏÜåÎ™Ö:', placeName, 'ÏãúÍ∞Ñ:', time);
          
          // Í∏∞Ï°¥ Í¥ÄÍ¥ëÏßÄ/ÎßõÏßë Î™©Î°ùÏóêÏÑú Îß§Ïπ≠ÎêòÎäî Ïû•ÏÜå Ï∞æÍ∏∞
          const foundPlace = allPlaces.find(place => {
            const placeNameLower = placeName.toLowerCase();
            const placeNameInList = place.name.toLowerCase();
            
            // Ï†ïÌôïÌïú Îß§Ïπ≠ ÎòêÎäî Î∂ÄÎ∂Ñ Îß§Ïπ≠
            return placeNameInList.includes(placeNameLower) || 
                   placeNameLower.includes(placeNameInList) ||
                   placeNameInList.includes(placeNameLower.replace(/\s+/g, '')) ||
                   placeNameLower.includes(placeNameInList.replace(/\s+/g, ''));
          });
          
          if (foundPlace) {
            console.log('Îß§Ïπ≠Îêú Ïû•ÏÜå:', foundPlace.name);
            places.push({
              name: foundPlace.name,
              location: foundPlace.geometry?.location,
              type: attractions.includes(foundPlace) ? 'attraction' : 'restaurant',
              rating: foundPlace.rating,
              visitOrder: visitOrder,
              time: time
            });
            foundPlaces.add(placeName);
            visitOrder++;
          } else {
            console.log('Îß§Ïπ≠ÎêòÏßÄ ÏïäÏùÄ Ïû•ÏÜå:', placeName);
          }
        }
      });
      
      // Î∞©Î¨∏ ÏàúÏÑúÎ°ú Ï†ïÎ†¨
      places.sort((a, b) => a.visitOrder - b.visitOrder);
      
      console.log('ÏµúÏ¢Ö Ï∂îÏ∂úÎêú Ïû•ÏÜåÎì§:', places);
      return places;
    }

    // ÏΩîÏä§ ÏßÄÎèÑ ÌëúÏãú Ìï®Ïàò
    function showCourseMap(courseIndex) {
      console.log('showCourseMap Ìò∏Ï∂úÎê®, courseIndex:', courseIndex);
      console.log('courseData:', courseData);
      
      if (!courseData[courseIndex]) {
        alert('ÏΩîÏä§ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      const course = courseData[courseIndex];
      console.log('ÏÑ†ÌÉùÎêú ÏΩîÏä§:', course);
      
      const popup = document.getElementById('courseMapPopup');
      const titleElement = document.getElementById('courseMapTitle');
      const mapElement = document.getElementById('courseMap');
      
      titleElement.textContent = course.title + ' - Í∏∏ÏïàÎÇ¥';
      popup.style.display = 'flex';
      
      // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
      if (courseMarkers.length > 0) {
        courseMarkers.forEach(marker => marker.setMap(null));
        courseMarkers = [];
      }
      
      // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî (ÏßÄÏó∞)
      setTimeout(() => {
        courseMap = new google.maps.Map(mapElement, {
          zoom: 12,
          center: destLatLng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        
        console.log('ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        console.log('ÏΩîÏä§ Ïû•ÏÜåÎì§:', course.places);
        
        // ÏΩîÏä§Ïùò Ïû•ÏÜåÎì§ÏùÑ ÏßÄÎèÑÏóê ÌëúÏãú
        const bounds = new google.maps.LatLngBounds();
        
        if (course.places && course.places.length > 0) {
          course.places.forEach((place, index) => {
            console.log('Ïû•ÏÜå Ï≤òÎ¶¨ Ï§ë:', place);
            
            if (place.location) {
              console.log('Ïû•ÏÜå ÏúÑÏπò:', place.location);
              
              // Í¥ÄÍ¥ëÏßÄÏôÄ ÎßõÏßëÏùÑ Îã§Î•∏ ÏïÑÏù¥ÏΩòÏúºÎ°ú Íµ¨Î∂Ñ
              const iconUrl = place.type === 'attraction' ? '/assets/attraction.png' : '/assets/restaurant.png';
              const iconSize = new google.maps.Size(32, 32);
              
              const marker = new google.maps.Marker({
                position: place.location,
                map: courseMap,
                title: `${place.visitOrder}. ${place.name}`,
                label: `${place.visitOrder}`,
                icon: {
                  url: iconUrl,
                  scaledSize: iconSize
                }
              });
              
              // Ï†ïÎ≥¥Ï∞Ω Ï∂îÍ∞Ä (Î∞©Î¨∏ ÏàúÏÑúÏôÄ ÏãúÍ∞Ñ Ìè¨Ìï®)
              const infoWindow = new google.maps.InfoWindow({
                content: `
                  <div style="padding: 10px; min-width: 200px;">
                    <h4 style="margin: 0 0 5px 0; color: #217093;">
                      ${place.visitOrder}. ${place.name}
                    </h4>
                    <p style="margin: 0 0 3px 0; font-size: 12px; color: #666;">
                      ${place.type === 'attraction' ? 'üèõÔ∏è Í¥ÄÍ¥ëÏßÄ' : 'üçΩÔ∏è ÎßõÏßë'}
                      ${place.rating ? ` | ‚≠ê ${place.rating}Ï†ê` : ''}
                    </p>
                    ${place.time ? `<p style="margin: 0; font-size: 12px; color: #ff6b35; font-weight: bold;">üïò ${place.time}</p>` : ''}
                  </div>
                `
              });
              
              marker.addListener('click', () => {
                infoWindow.open(courseMap, marker);
              });
              
              courseMarkers.push(marker);
              bounds.extend(place.location);
              console.log('ÎßàÏª§ Ï∂îÍ∞ÄÎê®:', place.name);
            } else {
              console.log('Ïû•ÏÜå ÏúÑÏπò Ï†ïÎ≥¥ ÏóÜÏùå:', place.name);
            }
          });
          
          // Î™®Îì† ÎßàÏª§Í∞Ä Î≥¥Ïù¥ÎèÑÎ°ù ÏßÄÎèÑ ÏòÅÏó≠ Ï°∞Ï†ï
          if (courseMarkers.length > 0) {
            courseMap.fitBounds(bounds);
            console.log('ÏßÄÎèÑ ÏòÅÏó≠ Ï°∞Ï†ï ÏôÑÎ£å, ÎßàÏª§ Ïàò:', courseMarkers.length);
          } else {
            console.log('ÌëúÏãúÌï† ÎßàÏª§Í∞Ä ÏóÜÏäµÎãàÎã§.');
          }
        } else {
          console.log('ÏΩîÏä§Ïóê Ïû•ÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.');
          // Í∏∞Î≥∏ ÏúÑÏπòÎ°ú ÏßÄÎèÑ ÏÑ§Ï†ï
          courseMap.setCenter(destLatLng);
        }
      }, 100);
    }

    // ÏΩîÏä§ ÏßÄÎèÑ ÌåùÏóÖ Îã´Í∏∞ Ìï®Ïàò
    function closeCourseMap() {
      document.getElementById('courseMapPopup').style.display = 'none';
      // ÎßàÏª§ Ï†úÍ±∞
      if (courseMarkers.length > 0) {
        courseMarkers.forEach(marker => marker.setMap(null));
        courseMarkers = [];
      }
      courseMap = null;
    }

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Google Maps API Î°úÎìú ÏãúÏûë
    window.onload = function() {
      loadGoogleMapAPI();
      var recommendBtn = document.getElementById('recommendContentBtn');
      if (recommendBtn) {
        recommendBtn.onclick = function() {
          // ÌÜ†Í∏Ä ÎèôÏûë: Ïù¥ÎØ∏ Ï∂îÏ≤úÏΩòÌÖêÏ∏†Í∞Ä Î≥¥Ïù¥Î©¥ Ïà®Í∏∞Í≥†, ÏïÑÎãàÎ©¥ Î≥¥Ïó¨Ï§å
          if (isRecommendContentActive) {
            showOnlyContentBarPopup('none'); // Î™®Îëê Ïà®ÍπÄ
            isRecommendContentActive = false;
          } else {
            showOnlyContentBarPopup('externalContentLinks');
            isRecommendContentActive = true;
          }
          if ('speechSynthesis' in window) window.speechSynthesis.cancel();
        };
      }
    };

    // ÎßàÏö∞Ïä§ ÎìúÎûòÍ∑∏Î°ú Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ ÏßÄÏõê
    (function() {
      const row = document.getElementById('siteScrollRow');
      let isDown = false, startX, scrollLeft;
      row.addEventListener('mousedown', (e) => {
        isDown = true;
        row.classList.add('active');
        startX = e.pageX - row.offsetLeft;
        scrollLeft = row.scrollLeft;
      });
      row.addEventListener('mouseleave', () => { isDown = false; row.classList.remove('active'); });
      row.addEventListener('mouseup', () => { isDown = false; row.classList.remove('active'); });
      row.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - row.offsetLeft;
        const walk = (x - startX) * 1.2;
        row.scrollLeft = scrollLeft - walk;
      });
      // ÌÑ∞Ïπò Ïä§ÏôÄÏù¥ÌîÑ ÏßÄÏõêÏùÄ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú overflow-x: autoÎ°ú ÎèôÏûë
    })();

    // Í¥ÄÍ¥ëÏßÄ/ÎßõÏßë ÏöîÏïΩ, Ï∂îÏ≤úÏΩîÏä§, Î™©Ï†ÅÏßÄ ÏïàÎÇ¥, Ï∂îÏ≤úÏΩòÌÖêÏ∏†Îäî Î™®Îëê contentBar ÎÇ¥Î∂ÄÏóêÏÑú ÌïòÎÇòÎßå Î≥¥Ïù¥ÎèÑÎ°ù show/hide Ï≤òÎ¶¨
    function showOnlyContentBarPopup(popupId) {
      document.getElementById('contentBar').style.display = 'flex';
      document.getElementById('destinationIntroInBar').style.display = 'none';
      document.getElementById('coursePopup').style.display = 'none';
      document.getElementById('summaryBox').style.display = 'none';
      document.getElementById('externalContentLinks').style.display = 'none';
      if ('speechSynthesis' in window) window.speechSynthesis.cancel();
      if (typeof restoreMusicPlayer === 'function') restoreMusicPlayer();
      if (popupId === 'destinationIntroInBar') document.getElementById('destinationIntroInBar').style.display = 'block';
      if (popupId === 'coursePopup') document.getElementById('coursePopup').style.display = 'block';
      if (popupId === 'summaryBox') document.getElementById('summaryBox').style.display = 'block';
      if (popupId === 'externalContentLinks') document.getElementById('externalContentLinks').style.display = 'flex';
      // Ï∂îÏ≤úÏΩòÌÖêÏ∏† Ïô∏ Î™®Îìú ÏßÑÏûÖ Ïãú ÌÜ†Í∏Ä ÏÉÅÌÉú Ìï¥Ï†ú
      if (popupId !== 'externalContentLinks') isRecommendContentActive = false;
      // Î™®Îëê Ïà®ÍπÄ Î™®Îìú
      if (popupId === 'none') document.getElementById('contentBar').style.display = 'none';
    }
  </script>
</body>